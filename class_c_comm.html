<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Barst: CComm Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Barst
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">A server that controls lab hardware.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="class_c_comm-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CComm Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="base_01classses_8h_source.html">base classses.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CComm:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_c_comm.png" usemap="#CComm_map" alt=""/>
  <map id="CComm_map" name="CComm_map">
<area href="class_c_pipe_server.html" alt="CPipeServer" shape="rect" coords="0,56,85,80"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0cbaae3b15b7023519475d1a8dc44de8"><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_comm.html#a0cbaae3b15b7023519475d1a8dc44de8">SendData</a> (const <a class="el" href="struct_s_data.html">SData</a> *pData, __int64 llId)=0</td></tr>
<tr class="separator:a0cbaae3b15b7023519475d1a8dc44de8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9ac6aab07e0bea55d71507775b72690"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_comm.html#ac9ac6aab07e0bea55d71507775b72690">Close</a> ()=0</td></tr>
<tr class="separator:ac9ac6aab07e0bea55d71507775b72690"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a1856bca3745123d3823d821b3037d36c"><td class="memItemLeft" align="right" valign="top"><a id="a1856bca3745123d3823d821b3037d36c"></a>
<a class="el" href="class_c_device.html">CDevice</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_pcDevice</b></td></tr>
<tr class="separator:a1856bca3745123d3823d821b3037d36c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7811a817865e19960f610bb8ca4a91"><td class="memItemLeft" align="right" valign="top"><a id="a7b7811a817865e19960f610bb8ca4a91"></a>
<a class="el" href="class_c_log_buffer.html">CLogBuffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_pcLogBuffer</b></td></tr>
<tr class="separator:a7b7811a817865e19960f610bb8ca4a91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3633fe46371e3eddd4969e64d188511"><td class="memItemLeft" align="right" valign="top"><a id="ac3633fe46371e3eddd4969e64d188511"></a>
<a class="el" href="class_c_mem_pool.html">CMemPool</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>m_pcMemPool</b></td></tr>
<tr class="separator:ac3633fe46371e3eddd4969e64d188511"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This defines a general communicator which lets you send and recieve massages from user. Typically each device gets its own comm for private use. The rule is that every device which has access to a comm and might have enqueued data to the comm to be sent to the user cannot be deleted while that comm is not stopped. I.e. you have to stop the comm and only then can you delete any of the devices which might have had access to the comm. This ensures a comm doesn't try to call a deleted device to which it had a pointer but is now an invalid pointer. So you typically: call close on the comm, delete the device and delete the comm.</p>
<p>At the moment, the rule is that when a device writes something to the comm using SendData, the <a class="el" href="struct_s_data.html">SData</a> struct used will be replicated in the comm (i.e. it doesn't have to be valid after the SendData call is completed), while the device and pHead in <a class="el" href="struct_s_data.html">SData</a> have to be valid until the comm is done with the data. The comm is done with the data after Close is called on the comm or if the comm calls Result(pHead, ...) on the device. Then you can delete pHead.</p>
<p>In addition to accepting data to be sent to a user (in which case using the <a class="el" href="struct_s_data.html">SData</a> struct we include a pointer to a device so that the comm knows who to notify after the data was sent, or not sent) the comm also needs to be initialized with a device pointer which it will call when a user has written data to it. In this case, the rule is that the data that the comm gives to the device using the ProcessData() function is only valid during the call to the device, so if the device needs access to the data afterwards it should be copied.</p>
<p>A single comm can communicate with multiple users simultaneuosly. This allows multiple users to send data at the same time. Therefore, we need a way to identify which user sent data to a particular device so when we get a ProcessData() call the device knows who to respond to. This is achieved using the llId parameter in the ProcessData() and <a class="el" href="class_c_comm.html#a0cbaae3b15b7023519475d1a8dc44de8">SendData()</a> function. When a user sends data to a device, the device is notified with ProcessData() which includes the llId param to uniquefy the user that sent it. When the device responds with <a class="el" href="class_c_comm.html#a0cbaae3b15b7023519475d1a8dc44de8">SendData()</a> the device includes this llId value so that the comm can reply to the correct user. The llId is unique and is incremented with each user that connects until it overflows back to zero (it's a 64-bit int). This guerantees that an llId of -1 is practically never reached, so -1 can used to initialize as an invalid value. </p>

<p class="definition">Definition at line <a class="el" href="base_01classses_8h_source.html#l00054">54</a> of file <a class="el" href="base_01classses_8h_source.html">base classses.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ac9ac6aab07e0bea55d71507775b72690"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9ac6aab07e0bea55d71507775b72690">&#9670;&nbsp;</a></span>Close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void CComm::Close </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Stops all communication with this comm, terminates all threads and returns it to its original state. Any data waiting to be sent is not sent but Result() is called on that data. </p>

<p>Implemented in <a class="el" href="class_c_pipe_server.html#ae6da9ec1907470b3ce561ba80cf642ac">CPipeServer</a>.</p>

</div>
</div>
<a id="a0cbaae3b15b7023519475d1a8dc44de8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cbaae3b15b7023519475d1a8dc44de8">&#9670;&nbsp;</a></span>SendData()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual int CComm::SendData </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_s_data.html">SData</a> *&#160;</td>
          <td class="paramname"><em>pData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__int64&#160;</td>
          <td class="paramname"><em>llId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sends data to a user identified by llId. Function returns TRUE if it failed and FALSE otherwise. At some point it could be extended to return an error code if needed. </p>

<p>Implemented in <a class="el" href="class_c_pipe_server.html#aef173a92816e84ecb92122268c86e0de">CPipeServer</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 25 2019 03:33:37 for Barst by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
